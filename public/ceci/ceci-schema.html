<polymer-element name="ceci-schema" attributes="schemaid name" name="New Schema">
  <template>
    <style>
      :host {
        display: none;
      }
    </style>
    <content></content>
  </template>
  <script>
    Polymer('ceci-schema', {
      attached: function() {
        var dataString = sessionStorage.getItem("ceci-collections-" + this.schemaid);
        var savedData = [];
        var self = this;
        if (dataString) {
          try {
            savedData = JSON.parse(dataString);
          } catch (e) {
            console.error("Error parsing saved data:", e);
          }
        }
        this.data = savedData || [];
        this.fire("dataloaded");
        this.observer = new ArrayObserver(this.data);
        this.observer.open(function(splices) {
          splices.forEach(function(splice) {
            var detail = {
              change: splice
            };
            self.fire("itemchange", detail);
          });
        });
      },
      addField: function(name) {
        var field = document.createElement("ceci-field");
        this.appendChild(field);
        field.name = name || "New Field";
        var detail = {
          added: field
        };
        this.fire("fieldchange", detail);
      },
      removeField: function(field) {
        this.removeChild(field);
        var detail = {
          removed: field
        };
        this.fire("fieldchange", detail);
      },
      nameChanged: function() {
        var detail = {
          changed: "kind"
        };
        this.fire("namechange");
      },
      addItem: function(item) {
        this.data.push(item);
        var detail = {
          added: item,
          index: this.data.length - 1
        };
        this.fire("itemchange", detail);
      },
      removeItem: function(index) {
        var detail = {
          removed: this.data.splice(index, 1)[0],
          index: index
        };
        this.fire("itemchange", detail);
      },
      updateItem: function(index, item) {
        var detail = {
          removed: this.data.splice(index, 1, item)[0],
          added: item,
          index: index
        };
        this.fire("itemchange", detail);
      },
      saveData: function() {
        sessionStorage.setItem("ceci-collections-" + this.schemaid, JSON.stringify(this.data));
      }
    });
  </script>
</polymer-element>
