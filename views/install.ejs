<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600">
  <link rel="stylesheet" href="<%= process.env.ASSET_HOST %>/stylesheets/install.css" />
  <title>My Appmaker App</title>
</head>
<body>
  <script type="template/html">
    <img src="<%= process.env.ASSET_HOST %>/images/chef-man.png">
    <h1>You'll need Firefox for this App</h1>
    <p>In order to install this app, you'll need to open this page in a
    Firefox browser. However, if you just want to see this app in action,
    click <a href="">here</a> to load it as a regular URL.</p>
  </script>
  <div class="install-container"></div>
  <script>
    document.addEventListener('DOMContentLoaded', function (e) {

      var container = document.querySelector(".install-container");

      // add install button if we're in FF, otherwise give user handy links
      if(navigator.mozApps && navigator.mozApps.install) {
        var installButton = document.createElement('button');
        container.appendChild(installButton);
        installButton.id = "install";
        installButton.innerHTML = "<%- gettext('Install App') %>"
        installButton.addEventListener('click', function (e) {
          var installRequest = navigator.mozApps.install('<%- manifestUrl %>');

          installRequest.onsuccess = function (data) {
            console.log('hooray!', data, this.result);
          };

          installRequest.onerror = function (err) {
            console.error(':(', this.error);
          };
        }, false);
      }

      else {
        var scr = document.querySelector("script[type='template/html']");
        container.innerHTML = scr.textContent;
        var a = container.querySelector("a");
        a.href = window.location.toString().replace("install.html", "index.html");
      }
    }, false);
  </script>
</body>
</html>
